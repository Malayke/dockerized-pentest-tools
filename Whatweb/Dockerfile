FROM ruby:2.6-alpine AS builder
WORKDIR /whatweb
COPY . .
# RUN gem install bundler && bundle update && bundle install --without test --verbose
RUN apk add --no-cache gcc make musl-dev
RUN make install

# The final image: we start clean
FROM ruby:2.6-alpine

# We copy over the entire gems directory for our builder image, containing the already built artifact
COPY --from=builder /usr/local/bundle/ /usr/local/bundle/
COPY --from=builder /whatweb /whatweb
WORKDIR /whatweb
ENTRYPOINT [ "./whatweb" ]